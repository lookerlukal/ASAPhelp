<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ASAP 帮助文档</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
        }
        
        /* 左侧导航栏样式 */
        #sidebar {
            width: 300px;
            background-color: #f5f6fa;
            border-right: 1px solid #dcdde1;
            overflow-y: auto;
            padding: 20px;
        }
        
        /* 右侧内容区域 */
        #content {
            flex: 1;
            padding: 20px;
            background-color: white;
        }
        
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        /* 文件列表样式优化 */
        .file-list {
            list-style: none;
            padding: 0;
        }
        .file-item {
            padding: 8px 12px;
            margin: 4px 0;
            border-radius: 4px;
            transition: background 0.3s;
        }
        .file-item:hover {
            background-color: #e6e9ed;
        }
        .file-link {
            color: #2c3e50;
            text-decoration: none;
            display: block;
        }
        
        /* 添加响应式设计 */
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }
            #sidebar {
                width: 100%;
                height: 40vh;
                border-right: none;
                border-bottom: 1px solid #dcdde1;
            }
            #content {
                height: 60vh;
            }
        }
    </style>
</head>
<body>
    <div id="sidebar">
        <h1>文档导航</h1>
        <div id="fileList"></div>
    </div>
    <div id="content">
        <iframe id="contentFrame" name="contentFrame"></iframe>
    </div>

    <script>
        // 动态加载配置文件
        let siteStructure = null;

        // 临时使用XMLHttpRequest替代fetch
        const xhr = new XMLHttpRequest();
        xhr.open('GET', 'site-config.json');
        xhr.onload = function() {
            if (xhr.status === 200) {
                const config = JSON.parse(xhr.responseText);
                console.log('配置结构验证:', {
                    isValid: !!config?.siteStructure?.children,
                    childrenCount: config?.siteStructure?.children?.length || 0
                });
                siteStructure = config.siteStructure;
                document.getElementById('fileList').innerHTML = buildFileList(siteStructure);
                console.log('渲染完成，DOM内容长度:', document.getElementById('fileList').innerHTML.length);
            }
        };
        xhr.send();

        function buildFileList(node, path = '') {
            let html = '<ul class="file-list">';
            for (const item of node.children) {
                const encodedName = encodeURIComponent(item.name);
                const currentPath = path ? 
                    `${path}/${encodedName}`.replace(/\/{2,}/g, '/') : 
                    encodedName;

                if (item.type === 'file') {
                    html += `
                        <li class="file-item">
                            <a href="${currentPath}" class="file-link" target="contentFrame">
                                📄 ${item.name}
                            </a>
                        </li>
                    `;
                } else if (item.type === 'directory') {
                    html += buildFileList(item, currentPath);
                }
            }
            html += '</ul>';
            return html;
        }
    </script>
</body>
</html>
