<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="ASAP光学软件帮助文档库，包含命令参考和实例分析">
    <meta name="keywords" content="ASAP, 光学设计, 照明设计, 光线追迹">
    <meta property="og:type" content="website">
    <meta property="og:title" content="ASAP帮助文档中心">
    <meta property="og:url" content="https://asaphelp.example.com">
    <title>ASAP 帮助文档</title>
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', system-ui, sans-serif;
            line-height: 1.6;
        }
        
        .document-list {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .category {
            margin-bottom: 2rem;
        }
        
        .category-title {
            color: #2b6eb5;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .document-item {
            margin-bottom: 1.5rem;
            padding: 1rem;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background: #fff;
        }
        
        .document-title {
            margin: 0 0 1rem 0;
        }
        
        .document-title a {
            color: #2b6eb5;
            text-decoration: none;
        }
        
        .document-title a:hover {
            text-decoration: underline;
        }
        
        .document-preview {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 4px;
            font-family: Consolas, monospace;
            white-space: pre-wrap;
            overflow-x: auto;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: #333;
        }
    </style>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "TechnicalArticle",
      "name": "ASAP帮助文档中心",
      "description": "ASAP光学软件帮助文档库，包含命令参考和实例分析",
      "articleSection": ["命令参考", "实例分析"],
      "keywords": "ASAP, 光学设计, 照明设计, 光线追迹"
    }
    </script>
</head>
<body>
    <div class="document-list">
        <h1>ASAP 文档中心</h1>
        
        <!-- 命令参考部分 -->
        <section class="category" id="commands">
            <h2 class="category-title">命令参考</h2>
            <div class="documents-container">
                <!-- Commands目录下的文档 -->
            </div>
        </section>
        
        <!-- 实例分析部分 -->
        <section class="category" id="examples">
            <h2 class="category-title">实例分析</h2>
            <div class="documents-container">
                <!-- Examples目录下的文档 -->
            </div>
        </section>
        
        <!-- 其他文档部分 -->
        <section class="category" id="others">
            <h2 class="category-title">其他文档</h2>
            <div class="documents-container">
                <!-- 其他目录下的文档 -->
            </div>
        </section>
    </div>

    <script>
        // 加载并显示文档列表
        async function loadDocuments() {
            try {
                const response = await fetch('site-config.json');
                const config = await response.json();
                
                // 处理文档结构
                processStructure(config.siteStructure);
            } catch (error) {
                console.error('加载文档失败:', error);
            }
        }

        function processStructure(node, path = '') {
            for (const item of node.children) {
                const currentPath = path ? `${path}/${item.name}` : item.name;
                
                if (item.type === 'file') {
                    // 确定文档类别
                    let category = 'others';
                    if (currentPath.startsWith('Commands/')) {
                        category = 'commands';
                    } else if (currentPath.startsWith('Examples/')) {
                        category = 'examples';
                    }
                    
                    // 创建文档项
                    createDocumentItem(item.name, currentPath, category);
                } else if (item.type === 'directory') {
                    processStructure(item, currentPath);
                }
            }
        }

        async function createDocumentItem(name, path, category) {
            const container = document.querySelector(`#${category} .documents-container`);
            
            const docItem = document.createElement('article');
            docItem.className = 'document-item';
            
            // 创建文档标题和链接
            const title = document.createElement('h3');
            title.className = 'document-title';
            const link = document.createElement('a');
            link.href = path;
            link.textContent = name;
            title.appendChild(link);
            
            // 添加文档预览
            const preview = document.createElement('div');
            preview.className = 'document-preview';
            
            try {
                const response = await fetch(path);
                const text = await response.text();
                
                // 根据文件类型处理预览内容
                let previewContent = '';
                if (path.toLowerCase().endsWith('.html')) {
                    // 对于HTML文件，提取body内容
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = text;
                    const bodyContent = tempDiv.querySelector('body');
                    if (bodyContent) {
                        // 移除脚本标签
                        const scripts = bodyContent.getElementsByTagName('script');
                        for (let i = scripts.length - 1; i >= 0; i--) {
                            scripts[i].remove();
                        }
                        // 获取纯文本内容
                        previewContent = bodyContent.textContent.trim();
                    }
                } else if (path.toLowerCase().endsWith('.inr')) {
                    // 对于INR文件，直接显示内容
                    previewContent = text;
                } else {
                    // 移除XML声明等标记
                    previewContent = text.replace(/<\?xml[^>]*\?>/, '')
                                       .replace(/<!DOCTYPE[^>]*>/, '')
                                       .replace(/<\/?[^>]+(>|$)/g, ' ')
                                       .replace(/\s+/g, ' ')
                                       .trim();
                }
                
                // 限制预览长度并添加省略号
                if (previewContent.length > 300) {
                    previewContent = previewContent.substring(0, 300) + '...';
                }
                
                preview.textContent = previewContent;
            } catch (error) {
                preview.textContent = '无法加载预览';
                console.error(`加载文件 ${path} 失败:`, error);
            }
            
            docItem.appendChild(title);
            docItem.appendChild(preview);
            container.appendChild(docItem);
        }

        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', loadDocuments);
    </script>

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "CollectionPage",
      "name": "ASAP文档库",
      "description": "包含ASAP软件的所有命令参考和实例分析文档",
      "hasPart": [
        // 自动生成文档列表
        ...siteStructure.children.map(doc => ({
          "@type": "TechArticle",
          "name": doc.name,
          "url": location.href + doc.path,
          "fileFormat": doc.name.split('.').pop()
        }))
      ]
    }
    </script>
</body>
</html>
