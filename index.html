<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>网站文件索引</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 20px;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 0.5em;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        li {
            margin: 5px 0;
            padding: 8px;
            background-color: #f0f4f8;
        }
        a {
            color: #2980b9;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        #fileList {
            min-height: 100px; /* 确保容器有高度 */
            overflow: visible !important; /* 覆盖可能存在的溢出隐藏 */
        }
        .folder, .subdir {
            display: none !important;
        }
    </style>
</head>
<body>
    <h1>网站文件目录索引</h1>
    <div id="fileList"></div>

    <script>
        // 动态加载配置文件
        let siteStructure = null;

        async function loadConfig() {
            try {
                const response = await fetch('site-config.json');
                if (!response.ok) throw new Error(`HTTP错误 ${response.status}`);
                const config = await response.json();
                return config.siteStructure;
            } catch (error) {
                console.error('配置加载失败:', error);
                return {
                    name: "根目录",
                    type: "directory",
                    children: [{
                        type: "file",
                        name: "⚠️ 配置加载失败，请检查site-config.json"
                    }]
                };
            }
        }

        function buildFileList(node, path = '') {
            console.group('构建节点:', node.name);
            let html = '<ul>';
            console.log('当前节点子项数量:', node.children.length);
            for (const item of node.children) {
                console.log('正在处理:', item.name, '类型:', item.type);
                const encodedName = encodeURIComponent(item.name)
                    .replace(/'/g, "%27")
                    .replace(/\(/g, "%28")
                    .replace(/\)/g, "%29");
                const currentPath = path ? 
                    `${path}/${encodedName}`.replace(/\/{2,}/g, '/') : 
                    encodedName;

                if (item.type === 'file') {
                    html += `
                <li>
                    📄 <a href="${currentPath}" target="_blank">${item.name}</a>
                </li>
            `;
                } else if (item.type === 'directory') {
                    html += buildFileList(item, currentPath);
                }
            }
            html += '</ul>';
            console.groupEnd();
            return html;
        }

        // 添加初始化完成检查
        (async function init() {
            try {
                const config = await loadConfig();
                console.log('初始化配置:', config);
                siteStructure = config;
                document.getElementById('fileList').innerHTML = buildFileList(siteStructure);
                console.log('渲染完成，DOM内容长度:', document.getElementById('fileList').innerHTML.length);
            } catch (error) {
                console.error('初始化失败:', error);
            }
        })();
    </script>
</body>
</html>
