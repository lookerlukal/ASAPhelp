<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ç½‘ç«™æ–‡ä»¶ç´¢å¼•</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 20px;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 0.5em;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        li {
            margin: 5px 0;
            padding: 8px;
            background-color: #f0f4f8;
        }
        a {
            color: #2980b9;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        #fileList {
            min-height: 100px; /* ç¡®ä¿å®¹å™¨æœ‰é«˜åº¦ */
            overflow: visible !important; /* è¦†ç›–å¯èƒ½å­˜åœ¨çš„æº¢å‡ºéšè— */
        }
        .folder, .subdir {
            display: none !important;
        }
    </style>
</head>
<body>
    <h1>ç½‘ç«™æ–‡ä»¶ç›®å½•ç´¢å¼•</h1>
    <div id="fileList"></div>

    <script>
        // åŠ¨æ€åŠ è½½é…ç½®æ–‡ä»¶
        let siteStructure = null;

        async function loadConfig() {
            try {
                const response = await fetch('site-config.json');
                if (!response.ok) throw new Error(`HTTPé”™è¯¯ ${response.status}`);
                const config = await response.json();
                return config.siteStructure;
            } catch (error) {
                console.error('é…ç½®åŠ è½½å¤±è´¥:', error);
                return {
                    name: "æ ¹ç›®å½•",
                    type: "directory",
                    children: [{
                        type: "file",
                        name: "âš ï¸ é…ç½®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥site-config.json"
                    }]
                };
            }
        }

        function buildFileList(node, path = '') {
            console.group('æ„å»ºèŠ‚ç‚¹:', node.name);
            let html = '<ul>';
            console.log('å½“å‰èŠ‚ç‚¹å­é¡¹æ•°é‡:', node.children.length);
            for (const item of node.children) {
                console.log('æ­£åœ¨å¤„ç†:', item.name, 'ç±»å‹:', item.type);
                const encodedName = encodeURIComponent(item.name)
                    .replace(/'/g, "%27")
                    .replace(/\(/g, "%28")
                    .replace(/\)/g, "%29");
                const currentPath = path ? 
                    `${path}/${encodedName}`.replace(/\/{2,}/g, '/') : 
                    encodedName;

                if (item.type === 'file') {
                    html += `
                <li>
                    ğŸ“„ <a href="${currentPath}" target="_blank">${item.name}</a>
                </li>
            `;
                } else if (item.type === 'directory') {
                    html += buildFileList(item, currentPath);
                }
            }
            html += '</ul>';
            console.groupEnd();
            return html;
        }

        // æ·»åŠ åˆå§‹åŒ–å®Œæˆæ£€æŸ¥
        (async function init() {
            try {
                const config = await loadConfig();
                console.log('åˆå§‹åŒ–é…ç½®:', config);
                siteStructure = config;
                document.getElementById('fileList').innerHTML = buildFileList(siteStructure);
                console.log('æ¸²æŸ“å®Œæˆï¼ŒDOMå†…å®¹é•¿åº¦:', document.getElementById('fileList').innerHTML.length);
            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
            }
        })();
    </script>
</body>
</html>
