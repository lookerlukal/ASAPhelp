<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="ASAP光学软件帮助文档库，包含命令参考和实例分析">
    <meta name="keywords" content="ASAP, 光学设计, 照明设计, 光线追迹">
    <meta property="og:type" content="website">
    <meta property="og:title" content="ASAP帮助文档中心">
    <meta property="og:url" content="https://asaphelp.example.com">
    <title>ASAP 帮助文档</title>
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: #f8f9fa;
            line-height: 1.6;
        }
        
        /* 左侧导航栏样式 */
        #sidebar {
            width: 280px;
            background: #2b303b;
            border-right: 1px solid #dcdde1;
            overflow-y: auto;
            padding: 20px;
            color: #adb5bd;
        }
        
        #sidebar h1 {
            color: #e9ecef;
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #4a5568;
        }
        
        /* 右侧内容区域 */
        #content {
            flex: 1;
            padding: 20px;
            background: #ffffff;
        }
        
        iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        /* 文件列表样式优化 */
        .file-list {
            list-style: none;
            padding: 0;
            margin-top: 1rem;
        }
        .file-item {
            padding: 8px 12px;
            margin: 4px 0;
            border-radius: 6px;
            transition: background 0.3s;
            background: rgba(255,255,255,0.05);
        }
        .file-item:hover {
            background: #4a5568;
        }
        .file-link {
            color: #e9ecef;
            text-decoration: none;
            display: block;
            font-size: 0.9rem;
        }
        
        /* 添加响应式设计 */
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }
            #sidebar {
                width: 100%;
                height: 50vh;
                padding: 15px;
            }
            #content {
                height: 50vh;
                padding: 15px;
            }
            #sidebar h1 {
                font-size: 1.5em;
            }
        }

        /* 代码块样式 */
        pre {
            background-color: #f4f4f4;
            padding: 1em;
            border-radius: 4px;
            overflow-x: auto;
        }

        code {
            font-family: 'Consolas', 'Monaco', monospace;
            color: #c7254e;
        }

        .loader {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 搜索框样式 */
        .search-box {
            margin-bottom: 1.5rem;
        }
        
        #searchInput {
            width: 100%;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            border: 1px solid #4a5568;
            background: #343a46;
            color: #e9ecef;
            outline: none;
        }

        #loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #3498db;
        }
    </style>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "TechnicalArticle",
      "name": "ASAP帮助文档中心",
      "description": "ASAP光学软件帮助文档库，包含命令参考和实例分析",
      "articleSection": ["命令参考", "实例分析"],
      "keywords": "ASAP, 光学设计, 照明设计, 光线追迹"
    }
    </script>
</head>
<body>
    <div id="sidebar">
        <h1>ASAP 文档中心</h1>
        <nav aria-label="文档分类导航">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="搜索文档...">
            </div>
            <h2>命令参考</h2>
            <div id="commandsList"></div>
            <h2>实例分析</h2>
            <div id="examplesList"></div>
        </nav>
        <div id="fileList"></div>
    </div>
    <div id="content">
        <iframe id="contentFrame" name="contentFrame"></iframe>
    </div>

    <div id="loading" style="display:none;">
        <div class="spinner"></div>
        <p>正在加载文件...</p>
    </div>

    <script>
        // 动态加载配置文件
        let siteStructure = null;

        // 临时使用XMLHttpRequest替代fetch
        const xhr = new XMLHttpRequest();
        xhr.open('GET', 'site-config.json');
        xhr.onload = function() {
            if (xhr.status === 200) {
                const config = JSON.parse(xhr.responseText);
                console.log('配置结构验证:', {
                    isValid: !!config?.siteStructure?.children,
                    childrenCount: config?.siteStructure?.children?.length || 0
                });
                siteStructure = config.siteStructure;
                document.getElementById('fileList').innerHTML = buildFileList(siteStructure);
                console.log('渲染完成，DOM内容长度:', document.getElementById('fileList').innerHTML.length);
            }
        };
        xhr.send();

        function buildFileList(node, path = '') {
            let html = '<ul class="file-list">';
            for (const item of node.children) {
                const encodedName = encodeURIComponent(item.name);
                const currentPath = path ? 
                    `${path}/${encodedName}`.replace(/\/{2,}/g, '/') : 
                    encodedName;

                if (item.type === 'file') {
                    const isINR = item.name.toLowerCase().endsWith('.inr');
                    html += `
                        <li class="file-item">
                            <a href="${currentPath}" 
                               class="file-link ${isINR ? 'inr-file' : ''}" 
                               target="contentFrame"
                               data-filepath="${currentPath}">
                                📄 ${item.name}
                            </a>
                            <noscript>
                                <a href="${currentPath}">${item.name}</a>
                            </noscript>
                        </li>
                    `;
                } else if (item.type === 'directory') {
                    html += `<li class="directory" aria-label="目录: ${item.name}">`;
                    html += `<h3 class="directory-name">${item.name}</h3>`;
                    html += buildFileList(item, currentPath);
                    html += '</li>';
                }
            }
            html += '</ul>';
            return html;
        }

        // 即时搜索功能
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase();
            document.querySelectorAll('.file-item').forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(query) ? 'block' : 'none';
            });
        });

        document.getElementById('fileList').addEventListener('click', async (e) => {
            const link = e.target.closest('.inr-file');
            if (link) {
                e.preventDefault();
                const filePath = link.dataset.filepath;
                
                document.getElementById('loading').style.display = 'block';
                
                try {
                    const response = await fetch(filePath);
                    const text = await response.text();
                    const contentDiv = document.createElement('div');
                    contentDiv.style.display = 'none';
                    contentDiv.innerHTML = text;
                    document.body.appendChild(contentDiv);
                    
                    document.getElementById('contentFrame').srcdoc = `
                        <pre>${text}</pre>
                        <style>
                            body {
                                margin: 0;
                                padding: 20px;
                                font-family: Consolas, monospace;
                                white-space: pre-wrap;
                                background: #f8f9fa;
                            }
                        </style>
                    `;
                } catch (error) {
                    console.error('文件加载失败:', error);
                    document.getElementById('contentFrame').srcdoc = `
                        <div style="color: red; padding: 20px;">
                            无法加载文件: ${filePath}
                        </div>
                    `;
                } finally {
                    document.getElementById('loading').style.display = 'none';
                }
            }
        });

        // 在初始化函数后添加INR文件处理
        document.getElementById('contentFrame').addEventListener('load', function() {
            if(this.contentDocument.body.innerText.includes('INR File Content')) {
                this.contentDocument.body.style.whiteSpace = 'pre-wrap';
                this.contentDocument.body.style.fontFamily = 'Consolas, monospace';
            }
        });
    </script>

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "CollectionPage",
      "name": "ASAP文档库",
      "description": "包含ASAP软件的所有命令参考和实例分析文档",
      "hasPart": [
        // 自动生成文档列表
        ...siteStructure.children.map(doc => ({
          "@type": "TechArticle",
          "name": doc.name,
          "url": location.href + doc.path,
          "fileFormat": doc.name.split('.').pop()
        }))
      ]
    }
    </script>
</body>
</html>
